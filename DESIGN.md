# Fava Modern UI - è®¾è®¡æ–¹æ¡ˆ

## 1. é¡¹ç›®å®šä½

åŸºäº Fava JSON API æ„å»ºçš„**ä¸ªäººè®°è´¦å¯è§†åŒ–å‰ç«¯**ï¼Œé¢å‘å·²æœ‰æˆç†Ÿ beancount è´¦æœ¬çš„ç”¨æˆ·ï¼Œèšç„¦äºï¼š

- **æ•°æ®å¯è§†åŒ–**ï¼šè´¦æˆ·ä½™é¢èµ°åŠ¿ã€æ”¯å‡ºåˆ†ç±»å æ¯”ã€å‡€èµ„äº§å˜åŒ–ç­‰
- **ä¾¿æ·æŸ¥è¯¢**ï¼šæ— éœ€è®°å¿† BQL è¯­æ³•ï¼Œé€šè¿‡ UI äº¤äº’å®Œæˆå¸¸ç”¨æŸ¥è¯¢
- **Dashboard**ï¼šæ›¿ä»£ fava-dashboard æ’ä»¶ï¼Œå†…ç½®å¯å®šåˆ¶çš„ä»ªè¡¨ç›˜
- **æ‰‹åŠ¨è®°è´¦**ï¼šæ”¯æŒé€šè¿‡è¡¨å•å¿«é€Ÿæ·»åŠ äº¤æ˜“

**ä¸åŒ…å«**çš„åŠŸèƒ½ï¼šé“¶è¡Œè´¦å•åŒæ­¥ã€OCR/è¯­éŸ³è®°è´¦ã€å¤šäººåä½œã€é¢„ç®—ç®¡ç†ï¼ˆbeancount æœ¬èº«æ— æ­¤æ¦‚å¿µï¼‰ã€‚

## 2. æŠ€æœ¯é€‰å‹

å»¶ç»­ demo çš„æŠ€æœ¯æ ˆï¼Œåšä»¥ä¸‹è°ƒæ•´ï¼š

| å±‚é¢ | é€‰å‹ | ç†ç”± |
|------|------|------|
| æ¡†æ¶ | React 18 + TypeScript | ä¿æŒä¸å˜ |
| æ„å»º | Vite | ä¿æŒä¸å˜ |
| UI ç»„ä»¶ | shadcn/ui + Tailwind CSS | ä¿æŒä¸å˜ï¼Œè¡¥å……æ›´å¤šç»„ä»¶ |
| å›¾è¡¨ | ECharts | demo å·²å¼•å…¥ï¼ŒåŠŸèƒ½å…¨é¢ |
| æ•°æ®è·å– | TanStack Query v5 | ä¿æŒä¸å˜ |
| çŠ¶æ€ç®¡ç† | Zustand | ä¿æŒä¸å˜ |
| è·¯ç”± | React Router v6 | ä¿æŒä¸å˜ |
| æ—¥æœŸå¤„ç† | date-fns | è½»é‡ï¼Œtree-shakeable |
| éƒ¨ç½² | Docker Compose (nginx + fava) | nginx åä»£ API + é™æ€èµ„æº |

## 3. ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Docker Compose                 â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   nginx:80   â”‚     â”‚   fava:5000      â”‚  â”‚
â”‚  â”‚              â”‚     â”‚                  â”‚  â”‚
â”‚  â”‚  /  â†’ é™æ€èµ„æºâ”‚     â”‚  beancount è´¦æœ¬   â”‚  â”‚
â”‚  â”‚  /api â†’ fava â”‚â”€â”€â”€â”€â–¶â”‚  JSON API        â”‚  â”‚
â”‚  â”‚              â”‚     â”‚                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â–²                                    â”‚
â”‚        â”‚ :80                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚   Browser    â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **fava å®¹å™¨**ï¼šåŠ è½½ç”¨æˆ·æŒ‚è½½çš„ `.beancount` æ–‡ä»¶ï¼Œå¯ç”¨ `--host 0.0.0.0`
- **nginx å®¹å™¨**ï¼šserve å‰ç«¯é™æ€èµ„æºï¼ˆVite build äº§ç‰©ï¼‰ï¼Œå°† `/<slug>/api/*` åä»£åˆ° fava
- ç”¨æˆ·è´¦æœ¬é€šè¿‡ Docker volume æŒ‚è½½

## 4. Fava API ç›˜ç‚¹

åŸºäº `json_api.py` ä¸­å·²æœ‰çš„ç«¯ç‚¹ï¼ŒæŒ‰åŠŸèƒ½æ¨¡å—åˆ†ç±»ï¼š

### 4.1 å¯ç›´æ¥ä½¿ç”¨çš„ API

| ç«¯ç‚¹ | æ–¹æ³• | ç”¨é€” |
|------|------|------|
| `/api/ledger_data` | GET | è´¦æœ¬å…ƒæ•°æ®ï¼ˆè´¦æˆ·åˆ—è¡¨ã€è´§å¸ã€payeeã€tag ç­‰ï¼‰ |
| `/api/changed` | GET | è½®è¯¢æ–‡ä»¶å˜åŒ– |
| `/api/errors` | GET | è´¦æœ¬é”™è¯¯åˆ—è¡¨ |
| `/api/balance_sheet` | GET | èµ„äº§è´Ÿå€ºè¡¨ï¼ˆå« net_worth å›¾è¡¨æ•°æ®ï¼‰ |
| `/api/income_statement` | GET | æŸç›Šè¡¨ï¼ˆå«æ”¶æ”¯æŸ±çŠ¶å›¾æ•°æ®ï¼‰ |
| `/api/trial_balance` | GET | è¯•ç®—å¹³è¡¡è¡¨ |
| `/api/account_report?a=<account>&r=changes` | GET | è´¦æˆ·è¯¦æƒ…ï¼ˆä½™é¢èµ°åŠ¿ + åŒºé—´å˜åŠ¨ï¼‰ |
| `/api/account_report?a=<account>` | GET | è´¦æˆ·æ—¥è®°è´¦ |
| `/api/journal` | GET | å…¨éƒ¨æ¡ç›®ï¼ˆæ”¯æŒ filter/time å‚æ•°ï¼‰ |
| `/api/events` | GET | äº‹ä»¶åˆ—è¡¨ |
| `/api/query?query_string=<bql>` | GET | æ‰§è¡Œ BQL æŸ¥è¯¢ |
| `/api/commodities` | GET | å•†å“ä»·æ ¼æ•°æ® |
| `/api/payee_accounts?payee=<p>` | GET | payee å…³è”è´¦æˆ·ï¼ˆè¾…åŠ©è®°è´¦ï¼‰ |
| `/api/payee_transaction?payee=<p>` | GET | payee æœ€è¿‘äº¤æ˜“ï¼ˆè¾…åŠ©è®°è´¦ï¼‰ |
| `/api/narrations` | GET | æ‰€æœ‰ narration åˆ—è¡¨ |
| `/api/add_entries` | PUT | æ·»åŠ æ–°æ¡ç›® |
| `/api/source` | GET | è·å–æºæ–‡ä»¶å†…å®¹ |
| `/api/source` | PUT | ä¿®æ”¹æºæ–‡ä»¶å†…å®¹ |
| `/api/context?entry_hash=<h>` | GET | æ¡ç›®ä¸Šä¸‹æ–‡ |

### 4.2 è¿‡æ»¤å‚æ•°

æ‰€æœ‰æŠ¥è¡¨ API å‡æ”¯æŒä»¥ä¸‹ query å‚æ•°ï¼š

- `time` â€” æ—¶é—´èŒƒå›´ï¼Œå¦‚ `2024`ã€`2024-01` è‡³ `2024-06`ã€`month`
- `account` â€” è´¦æˆ·è¿‡æ»¤
- `filter` â€” é«˜çº§è¿‡æ»¤ï¼ˆpayeeã€narrationã€tag ç­‰ï¼‰
- `interval` â€” èšåˆé—´éš”ï¼ˆ`day`/`week`/`month`/`quarter`/`year`ï¼‰
- `conversion` â€” è´§å¸è½¬æ¢

## 5. é¡µé¢ä¸åŠŸèƒ½è®¾è®¡

### 5.1 é¡µé¢ç»“æ„

```
â”œâ”€â”€ Dashboardï¼ˆé¦–é¡µï¼‰         â† æ–°å¢ï¼Œæ ¸å¿ƒé¡µé¢
â”œâ”€â”€ èµ„äº§æ€»è§ˆ
â”‚   â”œâ”€â”€ å‡€èµ„äº§èµ°åŠ¿
â”‚   â””â”€â”€ è´¦æˆ·ä½™é¢åˆ—è¡¨
â”œâ”€â”€ æ”¶æ”¯åˆ†æ
â”‚   â”œâ”€â”€ æ”¯å‡ºåˆ†ç±»å æ¯”
â”‚   â”œâ”€â”€ æ”¶å…¥åˆ†ç±»å æ¯”
â”‚   â””â”€â”€ æ”¶æ”¯è¶‹åŠ¿
â”œâ”€â”€ è´¦æˆ·è¯¦æƒ…                  â† ç‚¹å‡»ä»»æ„è´¦æˆ·è¿›å…¥
â”‚   â”œâ”€â”€ ä½™é¢èµ°åŠ¿
â”‚   â”œâ”€â”€ äº¤æ˜“æµæ°´
â”‚   â””â”€â”€ åŒºé—´å˜åŠ¨
â”œâ”€â”€ äº¤æ˜“æµæ°´ï¼ˆæ—¥è®°è´¦ï¼‰
â”œâ”€â”€ æ ‡ç­¾/é¡¹ç›®åˆ†æ             â† æ–°å¢ï¼ŒæŒ‰ tag èšåˆï¼ˆå¦‚æ—…è¡Œï¼‰
â”œâ”€â”€ å¿«é€Ÿè®°è´¦                  â† æ–°å¢
â””â”€â”€ è®¾ç½®
```

### 5.2 Dashboardï¼ˆé¦–é¡µï¼‰

æ›¿ä»£ fava-dashboard çš„æ ¸å¿ƒé¡µé¢ï¼Œå±•ç¤ºå…³é”®è´¢åŠ¡æŒ‡æ ‡å¡ç‰‡ï¼š

**æŒ‡æ ‡å¡ç‰‡ï¼ˆé¡¶éƒ¨ï¼‰**
- å‡€èµ„äº§ï¼ˆæ¥è‡ª `balance_sheet` çš„ Assets - Liabilitiesï¼‰
- æœ¬æœˆæ”¯å‡ºæ€»é¢
- æœ¬æœˆæ”¶å…¥æ€»é¢
- æœ¬æœˆç»“ä½™

**å›¾è¡¨åŒºåŸŸ**
- **å‡€èµ„äº§èµ°åŠ¿å›¾**ï¼ˆæŠ˜çº¿å›¾ï¼‰â€” æ¥è‡ª `balance_sheet` çš„ `charts[0].data`ï¼ˆtype=balances, net_worthï¼‰
- **æœˆåº¦æ”¶æ”¯å¯¹æ¯”**ï¼ˆæŸ±çŠ¶å›¾ï¼‰â€” æ¥è‡ª `income_statement` çš„ `charts[0].data`ï¼ˆtype=bar, net_profitï¼‰
- **æœ¬æœˆæ”¯å‡ºåˆ†ç±»**ï¼ˆé¥¼å›¾/ç¯å½¢å›¾ï¼‰â€” æ¥è‡ª `income_statement` çš„ `trees` ä¸­ Expenses èŠ‚ç‚¹çš„ `balance_children`
- **è¿‘æœŸäº¤æ˜“**ï¼ˆåˆ—è¡¨ï¼‰â€” æ¥è‡ª `journal` APIï¼Œå–æœ€è¿‘ 10 æ¡

**å®ç°æ–¹å¼**ï¼š
```typescript
// Dashboard æ•°æ®è·å–ç­–ç•¥
const { data: balanceSheet } = useQuery({
  queryKey: ['balance_sheet', { time: 'year-to-date' }],
  queryFn: () => api.getBalanceSheet({ time: '' })
});

const { data: incomeStatement } = useQuery({
  queryKey: ['income_statement', { time: currentMonth, interval: 'month' }],
  queryFn: () => api.getIncomeStatement({ time: currentMonth, interval: 'month' })
});
```

### 5.3 èµ„äº§æ€»è§ˆ

- **å‡€èµ„äº§èµ°åŠ¿**ï¼šæŠ˜çº¿å›¾ï¼Œæ”¯æŒåˆ‡æ¢æ—¶é—´èŒƒå›´ï¼ˆè¿‘1å¹´/3å¹´/å…¨éƒ¨ï¼‰
- **å„è´¦æˆ·ä½™é¢è¡¨æ ¼**ï¼šæ ‘å½¢è¡¨æ ¼ï¼ˆå¤ç”¨ demo çš„ AccountTreeTableï¼‰ï¼Œæ”¯æŒå±•å¼€æŠ˜å 
- **è´¦æˆ·ä½™é¢èµ°åŠ¿å¯¹æ¯”**ï¼šé€‰æ‹©å¤šä¸ªè´¦æˆ·å åŠ æŠ˜çº¿å›¾

æ•°æ®æ¥æºï¼š`GET /api/balance_sheet` + `GET /api/account_report?a=<account>&r=balances`

### 5.4 æ”¶æ”¯åˆ†æ

**æ”¯å‡ºåˆ†æ**
- ç¯å½¢å›¾ï¼šä¸€çº§åˆ†ç±»å æ¯”ï¼ˆå¦‚é¤é¥®ã€äº¤é€šã€è´­ç‰©ï¼‰
- æŸ±çŠ¶å›¾ï¼šæ¯æœˆæ”¯å‡ºè¶‹åŠ¿
- è¡¨æ ¼ï¼šåˆ†ç±»æ˜ç»†ï¼Œæ”¯æŒç‚¹å‡»æŸ¥çœ‹å­åˆ†ç±»
- æ—¶é—´èŒƒå›´é€‰æ‹©å™¨ï¼šæœ¬æœˆ/æœ¬å­£/æœ¬å¹´/è‡ªå®šä¹‰

**æ”¶å…¥åˆ†æ**
- åŒæ”¯å‡ºåˆ†æç»“æ„

**æ”¶æ”¯è¶‹åŠ¿**
- åŒè½´æŸ±çŠ¶å›¾ï¼šæ¯æœˆæ”¶å…¥ vs æ”¯å‡º
- æŠ˜çº¿å åŠ ï¼šç»“ä½™è¶‹åŠ¿

æ•°æ®æ¥æºï¼š`GET /api/income_statement`ï¼ˆå« interval_totals å›¾è¡¨æ•°æ®å’Œåˆ†ç±»æ ‘ï¼‰

### 5.5 è´¦æˆ·è¯¦æƒ…

ç‚¹å‡»ä»»æ„è´¦æˆ·åç§°è¿›å…¥ï¼š

- **ä½™é¢èµ°åŠ¿**ï¼ˆæŠ˜çº¿å›¾ï¼‰â€” `account_report` charts[0]
- **åŒºé—´å˜åŠ¨**ï¼ˆæŸ±çŠ¶å›¾ï¼‰â€” `account_report` charts[1]
- **äº¤æ˜“æµæ°´è¡¨æ ¼** â€” åˆ—å‡ºè¯¥è´¦æˆ·ä¸‹æ‰€æœ‰äº¤æ˜“ï¼Œæ”¯æŒæœç´¢/æ’åº

æ•°æ®æ¥æºï¼š`GET /api/account_report?a=<account>`

### 5.6 äº¤æ˜“æµæ°´

- å¯æœç´¢/ç­›é€‰çš„äº¤æ˜“åˆ—è¡¨
- æ”¯æŒæŒ‰ payeeã€narrationã€tagã€è´¦æˆ·ç­›é€‰
- ç­›é€‰å™¨ä»¥ä¸‹æ‹‰æ¡†å½¢å¼æä¾›ï¼Œæ•°æ®æ¥è‡ª `ledger_data` çš„ `payees`/`tags`/`accounts`
- ç‚¹å‡»æ¡ç›®å±•å¼€è¯¦æƒ…ï¼ˆä¸Šä¸‹æ–‡ï¼‰

æ•°æ®æ¥æºï¼š`GET /api/journal` + filter å‚æ•°

### 5.7 æ ‡ç­¾/é¡¹ç›®åˆ†æï¼ˆæ–°å¢ï¼‰

è§£å†³"æŸ¥çœ‹æŸæ¬¡æ—…è¡Œæ€»æ”¯å‡º"çš„éœ€æ±‚ï¼š

- å·¦ä¾§ï¼štag åˆ—è¡¨ï¼ˆæ¥è‡ª `ledger_data.tags`ï¼‰
- å³ä¾§ï¼šé€‰ä¸­ tag åï¼Œå±•ç¤ºè¯¥ tag ä¸‹çš„æ‰€æœ‰äº¤æ˜“å’Œç»Ÿè®¡
- å®ç°ï¼š`GET /api/journal?filter=#<tag>` æˆ– `GET /api/query?query_string=SELECT ...`

**ä½¿ç”¨ BQL æŸ¥è¯¢çš„å°è£…**ï¼š
```typescript
// æŒ‰ tag æŸ¥è¯¢æ”¯å‡ºæ±‡æ€»
api.getQuery(`SELECT account, sum(position) WHERE 'trip-japan' IN tags GROUP BY account`)

// æŒ‰ payee æŸ¥è¯¢
api.getQuery(`SELECT date, narration, position WHERE payee = 'æ˜Ÿå·´å…‹' ORDER BY date DESC`)
```

ç”¨æˆ·æ— éœ€æ‰‹å†™ BQLï¼Œå‰ç«¯å°†å¸¸ç”¨æŸ¥è¯¢å°è£…ä¸º UI äº¤äº’ã€‚

### 5.8 å¿«é€Ÿè®°è´¦

è¡¨å•å¼è®°è´¦é¡µé¢ï¼š

- **æ—¥æœŸ**ï¼šæ—¥æœŸé€‰æ‹©å™¨ï¼Œé»˜è®¤ä»Šå¤©
- **ç±»å‹**ï¼šæ”¯å‡º/æ”¶å…¥/è½¬è´¦
- **Payee**ï¼šå¯æœç´¢ä¸‹æ‹‰æ¡†ï¼ˆæ•°æ®æ¥è‡ª `ledger_data.payees`ï¼‰
- **Narration**ï¼šå¯æœç´¢ä¸‹æ‹‰æ¡† + è‡ªç”±è¾“å…¥ï¼ˆæ•°æ®æ¥è‡ª `api.getNarrations()`ï¼‰
- **è´¦æˆ·**ï¼šé€‰æ‹© payee åè‡ªåŠ¨æ¨èå…³è”è´¦æˆ·ï¼ˆ`api.getPayeeAccounts(payee)`ï¼‰
- **é‡‘é¢ + è´§å¸**
- **æ ‡ç­¾**ï¼šå¤šé€‰ï¼ˆæ•°æ®æ¥è‡ª `ledger_data.tags`ï¼‰
- **æäº¤**ï¼šè°ƒç”¨ `PUT /api/add_entries`

æ™ºèƒ½è¾…åŠ©ï¼š
- é€‰æ‹© payee åè‡ªåŠ¨å¡«å……ä¸Šæ¬¡çš„ narration å’Œè´¦æˆ·ï¼ˆ`api.getPayeeTransaction(payee)`ï¼‰
- å¸¸ç”¨äº¤æ˜“æ¨¡æ¿ï¼ˆå‰ç«¯æœ¬åœ°å­˜å‚¨ï¼‰

## 6. UI è®¾è®¡è§„èŒƒ

### 6.1 å¸ƒå±€

- **æ¡Œé¢ç«¯**ï¼šå·¦ä¾§å›ºå®šå¯¼èˆªæ ï¼ˆå¯æŠ˜å ï¼‰+ å³ä¾§å†…å®¹åŒº
- **ç§»åŠ¨ç«¯**ï¼šåº•éƒ¨ tab å¯¼èˆª + å…¨å±å†…å®¹åŒº
- æ•´ä½“ä½¿ç”¨ shadcn/ui çš„ neutral è‰²ç³»ï¼Œç®€æ´å…‹åˆ¶

### 6.2 ä¸»é¢˜

- æ”¯æŒæµ…è‰²/æ·±è‰²æ¨¡å¼ï¼ˆè·Ÿéšç³»ç»Ÿæˆ–æ‰‹åŠ¨åˆ‡æ¢ï¼‰
- Tailwind CSS `dark:` å‰ç¼€å®ç°

### 6.3 å¯¼èˆªç»“æ„

```
ä¾§è¾¹æ ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â˜° Fava UI       â”‚
â”‚                  â”‚
â”‚  ğŸ“Š Dashboard    â”‚
â”‚  ğŸ’° èµ„äº§æ€»è§ˆ     â”‚
â”‚  ğŸ“ˆ æ”¶æ”¯åˆ†æ     â”‚
â”‚  ğŸ“‹ äº¤æ˜“æµæ°´     â”‚
â”‚  ğŸ·ï¸ æ ‡ç­¾åˆ†æ     â”‚
â”‚  âœï¸ å¿«é€Ÿè®°è´¦     â”‚
â”‚                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  âš™ï¸ è®¾ç½®         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.4 å“åº”å¼æ–­ç‚¹

- `lg` (1024px+)ï¼šä¾§è¾¹æ å¸¸é©»
- `md` (768px-1024px)ï¼šä¾§è¾¹æ å¯æŠ˜å 
- `sm` (<768px)ï¼šåº•éƒ¨ tab å¯¼èˆª

## 7. å›¾è¡¨è®¾è®¡

æ‰€æœ‰å›¾è¡¨ä½¿ç”¨ EChartsï¼Œç»Ÿä¸€å°è£…ä¸º React ç»„ä»¶ï¼š

### 7.1 å›¾è¡¨ç»„ä»¶

```typescript
// é€šç”¨å›¾è¡¨ç»„ä»¶åˆ—è¡¨
<NetWorthChart />          // å‡€èµ„äº§èµ°åŠ¿ï¼ˆæŠ˜çº¿å›¾ï¼‰
<MonthlyBarChart />        // æœˆåº¦æ”¶æ”¯ï¼ˆå †å æŸ±çŠ¶å›¾ï¼‰
<CategoryPieChart />       // åˆ†ç±»å æ¯”ï¼ˆç¯å½¢å›¾ï¼‰
<AccountBalanceChart />    // è´¦æˆ·ä½™é¢èµ°åŠ¿ï¼ˆæŠ˜çº¿å›¾ï¼‰
<IntervalChangesChart />   // åŒºé—´å˜åŠ¨ï¼ˆæŸ±çŠ¶å›¾ï¼‰
```

### 7.2 æ•°æ®æ˜ å°„

Fava API è¿”å›çš„ `charts` å­—æ®µä¸­å·²åŒ…å«å›¾è¡¨æ•°æ®ï¼š

- `type: "balances"` â†’ æŠ˜çº¿å›¾ï¼Œ`data` ä¸º `[{date, balance}]`
- `type: "bar"` â†’ æŸ±çŠ¶å›¾ï¼Œ`data` ä¸º `[{date, balance, budgets}]`
- `type: "hierarchy"` â†’ æ ‘å›¾/é¥¼å›¾ï¼Œ`data` ä¸ºæ ‘å½¢ç»“æ„

å‰ç«¯åªéœ€å°†è¿™äº›æ•°æ®æ˜ å°„ä¸º ECharts optionã€‚

### 7.3 äº¤äº’

- å›¾è¡¨æ”¯æŒ tooltip æ‚¬åœæŸ¥çœ‹è¯¦æƒ…
- æŠ˜çº¿å›¾æ”¯æŒ dataZoom ç¼©æ”¾
- é¥¼å›¾æ”¯æŒç‚¹å‡»é’»å–å­åˆ†ç±»
- å›¾è¡¨ä¹‹é—´è”åŠ¨ï¼ˆECharts connectï¼‰

## 8. é¡¹ç›®ç»“æ„

```
dazzle/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ui/                    # shadcn/ui åŸºç¡€ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ charts/                # å›¾è¡¨ç»„ä»¶ï¼ˆæ–°å¢ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ NetWorthChart.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ MonthlyBarChart.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ CategoryPieChart.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ AccountBalanceChart.tsx
â”‚   â”‚   â”‚   â””â”€â”€ EChartsWrapper.tsx  # ECharts é€šç”¨å°è£…
â”‚   â”‚   â”œâ”€â”€ AccountTreeTable.tsx
â”‚   â”‚   â”œâ”€â”€ FilterBar.tsx
â”‚   â”‚   â”œâ”€â”€ Layout.tsx
â”‚   â”‚   â”œâ”€â”€ TransactionForm.tsx    # è®°è´¦è¡¨å•ï¼ˆæ–°å¢ï¼‰
â”‚   â”‚   â””â”€â”€ ThemeToggle.tsx        # ä¸»é¢˜åˆ‡æ¢ï¼ˆæ–°å¢ï¼‰
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useLedger.ts
â”‚   â”‚   â”œâ”€â”€ useChartData.ts        # å›¾è¡¨æ•°æ® hookï¼ˆæ–°å¢ï¼‰
â”‚   â”‚   â””â”€â”€ useTheme.ts            # ä¸»é¢˜ hookï¼ˆæ–°å¢ï¼‰
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ api.ts                 # API å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ queries.ts             # å¸¸ç”¨ BQL æŸ¥è¯¢å°è£…ï¼ˆæ–°å¢ï¼‰
â”‚   â”‚   â””â”€â”€ utils.ts
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ Dashboard.tsx          # é¦–é¡µä»ªè¡¨ç›˜ï¼ˆæ–°å¢ï¼‰
â”‚   â”‚   â”œâ”€â”€ Assets.tsx             # èµ„äº§æ€»è§ˆï¼ˆæ–°å¢ï¼‰
â”‚   â”‚   â”œâ”€â”€ IncomeExpense.tsx       # æ”¶æ”¯åˆ†æï¼ˆæ–°å¢ï¼‰
â”‚   â”‚   â”œâ”€â”€ Journal.tsx            # äº¤æ˜“æµæ°´
â”‚   â”‚   â”œâ”€â”€ TagAnalysis.tsx        # æ ‡ç­¾åˆ†æï¼ˆæ–°å¢ï¼‰
â”‚   â”‚   â”œâ”€â”€ QuickEntry.tsx         # å¿«é€Ÿè®°è´¦ï¼ˆæ–°å¢ï¼‰
â”‚   â”‚   â”œâ”€â”€ AccountDetail.tsx
â”‚   â”‚   â””â”€â”€ Settings.tsx           # è®¾ç½®ï¼ˆæ–°å¢ï¼‰
â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â””â”€â”€ ledger.ts
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ main.tsx
â”‚   â””â”€â”€ index.css
â”œâ”€â”€ docker/
â”‚   â”œâ”€â”€ Dockerfile                 # å¤šé˜¶æ®µæ„å»ºï¼šnode build â†’ nginx
â”‚   â”œâ”€â”€ nginx.conf                 # nginx é…ç½®
â”‚   â””â”€â”€ docker-compose.yml
â”œâ”€â”€ package.json
â”œâ”€â”€ vite.config.ts
â””â”€â”€ tailwind.config.js
```

## 9. Docker éƒ¨ç½²æ–¹æ¡ˆ

### 9.1 docker-compose.yml

```yaml
services:
  fava:
    image: python:3.12-slim
    command: >
      sh -c "pip install fava && fava /data/main.beancount
      --host 0.0.0.0 --port 5000"
    volumes:
      - ./beancount:/data:ro
    expose:
      - "5000"
    restart: unless-stopped

  ui:
    build:
      context: .
      dockerfile: docker/Dockerfile
    ports:
      - "8080:80"
    depends_on:
      - fava
    restart: unless-stopped
```

### 9.2 nginx.conf

```nginx
server {
    listen 80;

    location / {
        root /usr/share/nginx/html;
        try_files $uri $uri/ /index.html;
    }

    # åä»£ fava API â€” åŒ¹é… /<slug>/api/ è·¯å¾„
    location ~ ^/(.+)/api/ {
        proxy_pass http://fava:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

### 9.3 Dockerfileï¼ˆå¤šé˜¶æ®µæ„å»ºï¼‰

```dockerfile
# Stage 1: Build
FROM node:20-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

# Stage 2: Serve
FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
COPY docker/nginx.conf /etc/nginx/conf.d/default.conf
```

### 9.4 ç”¨æˆ·ä½¿ç”¨æ–¹å¼

```bash
# 1. å°† beancount æ–‡ä»¶æ”¾å…¥ beancount/ ç›®å½•
# 2. å¯åŠ¨
docker compose up -d
# 3. è®¿é—® http://localhost:8080
```

## 10. å®æ–½è·¯å¾„

### Phase 1ï¼šåŸºç¡€æ¡†æ¶ + Dashboard

- [ ] é¡¹ç›®éª¨æ¶æ­å»ºï¼ˆè·¯ç”±ã€Layoutã€ä¸»é¢˜åˆ‡æ¢ï¼‰
- [ ] ECharts é€šç”¨å°è£…ç»„ä»¶
- [ ] Dashboard é¡µé¢ï¼ˆæŒ‡æ ‡å¡ç‰‡ + 4 ä¸ªæ ¸å¿ƒå›¾è¡¨ï¼‰
- [ ] API å±‚å®Œå–„ï¼ˆè¡¥å…… queryã€narrations ç­‰ç«¯ç‚¹è°ƒç”¨ï¼‰

### Phase 2ï¼šæŠ¥è¡¨é¡µé¢

- [ ] èµ„äº§æ€»è§ˆï¼ˆå‡€èµ„äº§èµ°åŠ¿ + è´¦æˆ·åˆ—è¡¨ï¼‰
- [ ] æ”¶æ”¯åˆ†æï¼ˆåˆ†ç±»å æ¯” + è¶‹åŠ¿ï¼‰
- [ ] è´¦æˆ·è¯¦æƒ…ï¼ˆä½™é¢èµ°åŠ¿ + äº¤æ˜“æµæ°´ï¼‰
- [ ] äº¤æ˜“æµæ°´ï¼ˆå¯æœç´¢/ç­›é€‰åˆ—è¡¨ï¼‰

### Phase 3ï¼šé«˜çº§åŠŸèƒ½

- [ ] æ ‡ç­¾/é¡¹ç›®åˆ†æ
- [ ] å¿«é€Ÿè®°è´¦è¡¨å•
- [ ] BQL æŸ¥è¯¢å°è£…ï¼ˆå¸¸ç”¨æŸ¥è¯¢æ¨¡æ¿åŒ–ï¼‰

### Phase 4ï¼šéƒ¨ç½²

- [ ] Docker é…ç½®
- [ ] nginx åä»£é…ç½®
- [ ] æ–‡æ¡£ç¼–å†™

## 11. ä¸ Demo çš„å¯¹æ¯”

| ç»´åº¦ | Demo ç°çŠ¶ | è®¾è®¡æ–¹æ¡ˆ |
|------|-----------|----------|
| æ ¸å¿ƒå®šä½ | å¤åˆ» fava æŠ¥è¡¨ | ä¸ªäººè®°è´¦å¯è§†åŒ–å·¥å…· |
| é¦–é¡µ | èµ„äº§è´Ÿå€ºè¡¨ | Dashboard ä»ªè¡¨ç›˜ |
| å›¾è¡¨ | æ—  | ECharts å…¨é¢é›†æˆ |
| è®°è´¦ | æ—  | å¿«é€Ÿè®°è´¦è¡¨å• |
| æŸ¥è¯¢ | éœ€æ‰‹å†™ filter | UI åŒ–çš„ç­›é€‰ + BQL å°è£… |
| æ ‡ç­¾åˆ†æ | æ—  | ä¸“é—¨é¡µé¢ |
| æš—è‰²æ¨¡å¼ | æ—  | æ”¯æŒ |
| éƒ¨ç½² | æ‰‹åŠ¨å¯åŠ¨ | Docker Compose ä¸€é”®éƒ¨ç½² |

Demo çš„æŠ€æœ¯é€‰å‹åˆç†ï¼Œä»£ç ç»“æ„æ¸…æ™°ï¼Œå¯ä»¥ä½œä¸ºåŸºç¡€ç»§ç»­å¼€å‘ã€‚ä¸»è¦å·¥ä½œæ˜¯æ–°å¢é¡µé¢ã€é›†æˆå›¾è¡¨ã€å®Œå–„äº¤äº’ã€‚
